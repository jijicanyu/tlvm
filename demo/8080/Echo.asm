;; echo
OUTDATA  EQU 0x01
INDATA   EQU 0x02
IOSTAT   EQU 0x03

OUTREADY EQU 0x01
INREADY  EQU 0x02

QUIT     EQU 0x24 			;; $
NULL	 EQU 0x00

JMP MAIN
CHECK_INPUT:				;; 0x0003
	MVI C,0x00				;; Returns input (or zero) in C
	PUSH PSW
	IN IOSTAT
	CPI INREADY
	JNZ CHECK_INPUT_END
	IN INDATA
	MOV C,A
CHECK_INPUT_END:			;; 0x0010
	POP PSW
	RET
DO_OUTPUT:					;; 0x0012
	PUSH PSW
DO_OUTPUT_LOOP:				;; 0x0013
	IN IOSTAT
	CPI OUTREADY
	JNZ DO_OUTPUT_LOOP
	MOV A,C
	OUT OUTDATA
	POP PSW
	RET
MAIN:						;; 0x001F
	STA 0x01FF
	CALL CHECK_INPUT
	MOV C,A
	CPI QUIT
	JZ EXIT
	CPI NULL
	JZ MAIN
	CALL DO_OUTPUT
	JMP MAIN
EXIT:
	HLT
